"""\nMigration script: Blueprint v2 columns for Supabase.\n"""\nimport sys\nfrom pathlib import Path\nsys.path.insert(0, str(Path(__file__).resolve().parent.parent))\n\nfrom sqlalchemy import text\nfrom core.models import Base, engine\n\ndef add_column_safe(conn, table, column, col_type, default=None):\n    try:\n        default_clause = f" DEFAULT '{default}'" if default is not None else ""\n        conn.execute(text(f"ALTER TABLE {table} ADD COLUMN {column} {col_type}{default_clause}"))\n        print(f"  OK {table}.{column} added")\n    except Exception as e:\n        if "already exists" in str(e).lower() or "duplicate column" in str(e).lower():\n            print(f"  SKIP {table}.{column} already exists")\n        else:\n            print(f"  WARN {table}.{column} error: {e}")\n\ndef run_migration():\n    print("Running Blueprint v2 Migration...")\n    Base.metadata.create_all(bind=engine)\n    print("New tables created")\n    with engine.begin() as conn:\n        add_column_safe(conn, "agent_configs", "template_type", "VARCHAR", "catalogue")\n        add_column_safe(conn, "agent_configs", "target_api", "VARCHAR", "playwright")\n        add_column_safe(conn, "agent_configs", "pagination_selector", "VARCHAR")\n        add_column_safe(conn, "agent_configs", "max_pages", "INTEGER", "1")\n        add_column_safe(conn, "agent_configs", "requires_scroll", "BOOLEAN", "false")\n        add_column_safe(conn, "offres_retail", "prix_brut", "FLOAT")\n        add_column_safe(conn, "offres_retail", "valeur_coupon", "FLOAT", "0")\n        add_column_safe(conn, "offres_retail", "valeur_odr", "FLOAT", "0")\n        add_column_safe(conn, "offres_retail", "remise_fidelite", "FLOAT", "0")\n        add_column_safe(conn, "offres_retail", "prix_net_net_calcule", "FLOAT")\n        add_column_safe(conn, "offres_retail", "validation_humaine_phase_1", "VARCHAR", "PENDING")\n        add_column_safe(conn, "market_sonde", "prix_amazon", "FLOAT")\n        add_column_safe(conn, "market_sonde", "prix_rakuten", "FLOAT")\n        add_column_safe(conn, "market_sonde", "volume_ventes_estime", "INTEGER")\n        add_column_safe(conn, "collision_results", "certification_finale", "VARCHAR", "PENDING_PHASE2")\n    print("Migration complete!")\n\nif __name__ == "__main__":\n    run_migration()\n